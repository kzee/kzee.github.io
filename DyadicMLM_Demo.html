<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Bayesian Dyadic Multilevel Modeling</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 64px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h2 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h3 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h4 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h5 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h6 {
  padding-top: 69px;
  margin-top: -69px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Katherine S. Zee</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="research.html">Research</a>
</li>
<li>
  <a href="publications.html">Publications</a>
</li>
<li>
  <a href="teaching.html">Teaching</a>
</li>
<li>
  <a href="rcode.html">R Code</a>
</li>
<li>
  <a href="resources.html">Resources</a>
</li>
<li>
  <a href="files/KatherineZeeCV.pdf">CV</a>
</li>
<li>
  <a href="contact.html">Contact</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Bayesian Dyadic Multilevel Modeling</h1>

</div>

<div id="TOC">
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#dyads-chapter-ch.-8-example-from-bolger-laurenceau-2013">Dyads Chapter (Ch. 8) Example from Bolger &amp; Laurenceau (2013)</a></li>
<li><a href="#load-packages">Load Packages</a></li>
<li><a href="#read-in-data">Read in Data</a></li>
<li><a href="#reformat-data">Reformat Data</a><ul>
<li><a href="#a.-subset-out-female-partner-observations-and-rename-columns-with-prefix-f_">A. Subset out female partner observations and rename columns with prefix &quot;f_&quot;</a></li>
<li><a href="#b.-subset-out-male-partner-observations-and-rename-columns-with-prefix-m_-also-remove-duplicated-columns-that-we-dont-need">B. subset out male partner observations and rename columns with prefix &quot;m_&quot;, also remove duplicated columns that we don't need</a></li>
<li><a href="#c.-merge-dataframes-with-female-data-and-male-data.">C. Merge dataframes with female data and male data.</a></li>
</ul></li>
<li><a href="#fit-model">Fit Model</a><ul>
<li><a href="#d.-set-up-brms-formulas">D. Set up brms formulas</a></li>
<li><a href="#e.-plug-in-the-two-bfs-into-a-brm-model.">E. Plug in the two bfs into a brm model.</a></li>
</ul></li>
<li><a href="#fit-model-with-maximum-likelihood-nlme-to-compare">Fit Model with Maximum Likelihood (<code>nlme</code>) to compare</a></li>
</ul>
</div>

<p><font size="3"></p>
<div id="overview" class="section level1">
<h1>Overview</h1>
<p>In this demo, I will show how to model intensive longitudinal data of distinguishable dyads using a Bayesian approach.</p>
<p>For those less familiar with dyadic analysis, it is an extremely interesting and important type of analysis that is useful for cases where we are interested in examining multiple outcomes with meaningful grouping. A classic example of this is the case of married couples, where X and Y variables are measured repeatedly for each partner in a couple. As may seem obvious, when working with individuals who are grouped in dyads, we cannot treat the individuals in the dyad as being separate individuals. They are <em>nonindependent</em> and by virtue of their relationship, they are going to show associations in their data that would not be expected for two randomly paired individuals.</p>
<p>The &quot;distinguishable&quot; part of distinguishable dyads indicates that the individuals within a dyad have some differentiating feature that they carry with them for the duration of the study. Returning to the earlier example, heterosexual married couples are an example of a distinguishable dyad: There is a wife and a husband, and these roles are fixed throughout the study. Parent and child would be another example, or supervisor and employee.</p>
<p>The analysis of dyadic intensive longitudinal data, such as those collected from daily diary studies or laboratory studies with intensively sampled measurements, is discussed in the book <a href="http://intensivelongitudinal.com/" target="_blank"><em>Intensive Longitudinal Methods: An Introduction to Diary and Experience Sampling Research</em> by Niall Bolger and J-P Laurenceau (2013)</a>. The purpose of this demo is to show how their example analysis from Chapter 8 can be implemented in a Bayesian framework using the <em>brms</em> package in R.</p>
<p><em>brms</em> offers some key advantages to this kind of analysis. First, as discussed in Chapter 8, most multilevel software programs can only handle a single outcome. But, dyadic data are multivariate: There is an outcome measure for each partner. Typically, this issue can be circumvented by stacking one's dataset and using dummy coded variables to estimate effects separately for each dyad member within one model. <em>brms</em> can handle true multivariate models, however, which bypasses the need for stacking the data, thereby saving some time at the data processing stage. Second, currently available R packages for multilevel modeling using maximum likelihood estimation do not presently allow one to estimate all features of a dyadic multilevel model. This comes in in the error structures. As discussed in Chapter 8, it is advisable to use what is known as an UN@AR(1) error structure, which combines both an autocorrelation part and a cross-partner correlation part on the residuals. The <code>nlme</code> package can estimate an AR(1) error structure OR correlated residuals between dyad members, but not both. The <code>lme4</code> package does not allow not allow the user to specify error structures. <code>brms</code>, however, can do both. And as we will see in a moment, it is also advantageous because it can generate separate AR(1) estimates for each partner; to my knowledge, this is not currently supported in <code>nlme</code>.</p>
<p>Now that we have some background, on to the analysis!</p>
<p><br></p>
</div>
<div id="dyads-chapter-ch.-8-example-from-bolger-laurenceau-2013" class="section level1">
<h1>Dyads Chapter (Ch. 8) Example from Bolger &amp; Laurenceau (2013)</h1>
<p>We will draw on the example from Chapter 8 of Bolger &amp; Laurenceau's wonderful book.</p>
<p><br></p>
</div>
<div id="load-packages" class="section level1">
<h1>Load Packages</h1>
<pre class="r"><code>library(dplyr)
library(data.table)
library(brms)</code></pre>
<p><br></p>
</div>
<div id="read-in-data" class="section level1">
<h1>Read in Data</h1>
<p>We can pull in the data directly from the <a href="http://www.intensivelongitudinal.com" target="_blank">book's website</a>.</p>
<pre class="r"><code>c &lt;- as.data.frame(
  fread(&quot;curl http://www.intensivelongitudinal.com/ch8/ch8R.zip | tar -xf- --to-stdout *dyads.csv&quot;)
)

head(c)</code></pre>
<pre><code>##   coupleid personid time     time7c gender female male reldis wrkstrs
## 1        1        1    0 -1.5000000      1      1    0   3.03       3
## 2        1        1    1 -1.3571429      1      1    0   4.62       3
## 3        1        1    2 -1.2142857      1      1    0   2.85       3
## 4        1        1    3 -1.0714286      1      1    0   6.40       4
## 5        1        1    4 -0.9285714      1      1    0   2.54       1
## 6        1        1    5 -0.7857143      1      1    0   5.16       2
##     wrkstrsc  wrkstrscb  wrkstrscw
## 1  0.0095238 -0.3238095  0.3333333
## 2  0.0095238 -0.3238095  0.3333333
## 3  0.0095238 -0.3238095  0.3333333
## 4  1.0095238 -0.3238095  1.3333333
## 5 -1.9904762 -0.3238095 -1.6666667
## 6 -0.9904762 -0.3238095 -0.6666667</code></pre>
<p><br></p>
</div>
<div id="reformat-data" class="section level1">
<h1>Reformat Data</h1>
<p>As discussed above, <code>brms</code> can estimate &quot;true&quot; multivariate models, so there is no need to stack the dataset and use dummies for female and male, as with <code>nlme</code> and <code>lme4</code>. But, we still need to do some pre-processing of the data for use with <em>brms</em>: The data needs to be arranged such that there is one row per timepoint per dyad, with separate columns for male and female variables</p>
<p><br></p>
<div id="a.-subset-out-female-partner-observations-and-rename-columns-with-prefix-f_" class="section level2">
<h2>A. Subset out female partner observations and rename columns with prefix &quot;f_&quot;</h2>
<p>First, we will subset out the data for the female partner. We will then relabel the columns, adding the prefix &quot;f_&quot; to most variable names to indicate that they refer to the female partner.</p>
<pre class="r"><code>ch8_f &lt;- subset(c, female == 1)
colnames(ch8_f) &lt;- c(&quot;coupleid&quot;, &quot;f_personid&quot;, &quot;time&quot;, 
                     &quot;time7c&quot;, &quot;gender&quot;, &quot;female&quot;, &quot;male&quot;, &quot;f_reldis&quot;,
                     &quot;f_wrkstrs&quot;, &quot;f_wrkstrsc&quot;, &quot;f_wrkstrscb&quot;, &quot;f_wrkstrscw&quot;)
head(ch8_f)</code></pre>
<pre><code>##   coupleid f_personid time     time7c gender female male f_reldis f_wrkstrs
## 1        1          1    0 -1.5000000      1      1    0     3.03         3
## 2        1          1    1 -1.3571429      1      1    0     4.62         3
## 3        1          1    2 -1.2142857      1      1    0     2.85         3
## 4        1          1    3 -1.0714286      1      1    0     6.40         4
## 5        1          1    4 -0.9285714      1      1    0     2.54         1
## 6        1          1    5 -0.7857143      1      1    0     5.16         2
##   f_wrkstrsc f_wrkstrscb f_wrkstrscw
## 1  0.0095238  -0.3238095   0.3333333
## 2  0.0095238  -0.3238095   0.3333333
## 3  0.0095238  -0.3238095   0.3333333
## 4  1.0095238  -0.3238095   1.3333333
## 5 -1.9904762  -0.3238095  -1.6666667
## 6 -0.9904762  -0.3238095  -0.6666667</code></pre>
<p><br></p>
</div>
<div id="b.-subset-out-male-partner-observations-and-rename-columns-with-prefix-m_-also-remove-duplicated-columns-that-we-dont-need" class="section level2">
<h2>B. subset out male partner observations and rename columns with prefix &quot;m_&quot;, also remove duplicated columns that we don't need</h2>
<p>We will do something similar for the male partner's data. Note that we have also used the pipe (<code>%&gt;%</code>) from the <code>dplyr</code> package to also indicate that we want to drop the variables <code>time7c</code>, <code>gender</code>, <code>male</code>, and <code>female</code> from our dataset. The reason for dropping these variables is that we are going to bind the columns from the female partners' data and the columns from the male partners' data together in a next step. This would lead to duplicated columns that we don't actually need for our analysis.</p>
<pre class="r"><code>ch8_m &lt;- subset(c, male == 1) %&gt;% dplyr::select(-time7c, -gender, -male, -female)
colnames(ch8_m) &lt;- c(&quot;coupleid&quot;, &quot;m_personid&quot;, &quot;time&quot;, 
                     &quot;m_reldis&quot;, &quot;m_wrkstrs&quot;, &quot;m_wrkstrsc&quot;, &quot;m_wrkstrscb&quot;, &quot;m_wrkstrscw&quot;)
head(ch8_m)</code></pre>
<pre><code>##    coupleid m_personid time m_reldis m_wrkstrs m_wrkstrsc m_wrkstrscb
## 22        1          2    0     4.46         3  0.0095238  -0.1333333
## 23        1          2    1     4.88         3  0.0095238  -0.1333333
## 24        1          2    2     4.58         3  0.0095238  -0.1333333
## 25        1          2    3     4.49         1 -1.9904762  -0.1333333
## 26        1          2    4     5.04         3  0.0095238  -0.1333333
## 27        1          2    5     4.87         3  0.0095238  -0.1333333
##    m_wrkstrscw
## 22   0.1428571
## 23   0.1428571
## 24   0.1428571
## 25  -1.8571429
## 26   0.1428571
## 27   0.1428571</code></pre>
<p><br></p>
</div>
<div id="c.-merge-dataframes-with-female-data-and-male-data." class="section level2">
<h2>C. Merge dataframes with female data and male data.</h2>
<p>Next, we will merge the two partial datasets together--the data for female partners and for the male partners. We will merge the data by <code>coupleid</code>, which is shared by couple members, and by <code>time</code>, to preserve information about the time dependency.</p>
<pre class="r"><code>ch8 &lt;- merge(ch8_f, ch8_m, by = c(&quot;coupleid&quot;, &quot;time&quot;))
head(ch8)</code></pre>
<pre><code>##   coupleid time personid.x      time7c gender female male f_reldis f_wrkstrs
## 1        1    0          1 -1.50000000      1      1    0     3.03         3
## 2        1    1          1 -1.35714286      1      1    0     4.62         3
## 3        1   10          1 -0.07142857      1      1    0     5.70         2
## 4        1   11          1  0.07142857      1      1    0     5.89         1
## 5        1   12          1  0.21428571      1      1    0     4.90         3
## 6        1   13          1  0.35714286      1      1    0     4.86         4
##   f_wrkstrsc f_wrkstrscb f_wrkstrscw personid.y m_reldis m_wrkstrs m_wrkstrsc
## 1  0.0095238  -0.3238095   0.3333333          2     4.46         3  0.0095238
## 2  0.0095238  -0.3238095   0.3333333          2     4.88         3  0.0095238
## 3 -0.9904762  -0.3238095  -0.6666667          2     4.36         2 -0.9904762
## 4 -1.9904762  -0.3238095  -1.6666667          2     4.91         3  0.0095238
## 5  0.0095238  -0.3238095   0.3333333          2     4.91         3  0.0095238
## 6  1.0095238  -0.3238095   1.3333333          2     3.72         4  1.0095238
##   m_wrkstrscb m_wrkstrscw
## 1  -0.1333333   0.1428571
## 2  -0.1333333   0.1428571
## 3  -0.1333333  -0.8571429
## 4  -0.1333333   0.1428571
## 5  -0.1333333   0.1428571
## 6  -0.1333333   1.1428571</code></pre>
<p><br></p>
</div>
</div>
<div id="fit-model" class="section level1">
<h1>Fit Model</h1>
<p>Now that are our data are prepped and formatted correctly, we are now ready for the analysis.</p>
<p><br></p>
<div id="d.-set-up-brms-formulas" class="section level2">
<h2>D. Set up brms formulas</h2>
<p>The first step is to set up the brms formulas, with the <code>bf()</code> function. This will specify the models that we want to fit. As you can see below, we will set up two brms formulas: one for female partner and one for male partner.</p>
<p>For each partner, we are modeling relationship dissatisfaction as a function of an intercept term, time (centered), within-person centered work stressors, and between-person centered work stressors as fixed effects. We also model random intercepts and random slopes of time and work stressors for each subject. Note that the latter variables were already centered accordingly when we got the data from the book's websites.</p>
<p>A difference in syntax compared to most <em>brms</em> models (and other multilevel packages) is the <code>|p|</code> term. <code>|p|</code> indicates that we want to model correlations of random effects (the choice of the letter p is arbitrary). To get cross-partner correlations, the letter inside || should be the same in both formulas. For our purposes, those cross-partner correlations are potentially very interesting and important (e.g., do female partners who show stronger effects of work stressors on relationship dissatisfaction have male partners who also show stronger effects of work stressors on relationship dissatisfaction?).</p>
<p>As a finale note, I have modeled the (fixed) intercept with the code <code>O + intercept</code> rather than writing in <code>1</code> or nothing at all (the default). This won't make a difference for our purposes, but this method of modeling the intercept can be useful in cases where we want to set common priors for intercepts and slopes. We are not setting priors here (we use the default priors, which range from -<span class="math inline">\(\infty\)</span> to +<span class="math inline">\(\infty\)</span>), so it won't make a difference in terms of the estimates. But just mentioning it here to clarify.</p>
<pre class="r"><code>f_model &lt;- bf(f_reldis ~ 0 + intercept + time7c + f_wrkstrscw + f_wrkstrscb + (time7c + f_wrkstrscw |p| coupleid))

m_model &lt;- bf(m_reldis ~ 0 + intercept + time7c + m_wrkstrscw + + m_wrkstrscb + (time7c + m_wrkstrscw |p| coupleid))</code></pre>
<p><br></p>
</div>
<div id="e.-plug-in-the-two-bfs-into-a-brm-model." class="section level2">
<h2>E. Plug in the two bfs into a brm model.</h2>
<p>Now that we have specified our brms formulas, we can put them into a model usign the <code>brm()</code> function.</p>
<p>By default, multivariate models in <em>brms</em> model correlated residuals, which is useful since this is a dyadic analysis and it is entirely plausible that there will be other variables that explain the relationship between dyad members' outcomes that we didn't not explicitly model.</p>
<p>We can also specify an AR(1) error structure, given by the <code>autocor = cor_ar(~ time7c | coupleid, p = 1)</code>. The <code>p = 1</code> part indicates the lag. For our purposes, this part is unnecessary to specify, as <code>cor_ar</code> defaults to AR(1) already.</p>
<p>As a note, the model sometimes produces warnings about adding more iterations. For a paper, I would probably rerun the analysis and increase the number of iterations. But, this is a demo and the results are extremely similar to those reported in the Bolger &amp; Laurenceau book, so it is not essential for our purposes.</p>
<pre class="r"><code>fit &lt;- brm(f_model + m_model, data = ch8, 
           seed = 111, # set a seed to ensure reproducibility
           iter = 8000, # number of iterations
           autocor = cor_ar(~ time7c | coupleid, p = 1))</code></pre>
<p><br></p>
<p>Be advised that this model might take awhile (several hours) to run! You can save your model object so you don't have to run the model from scratch each time you start a new R session. It will automatically save the model object .rds file to your working directory unless you set another location as part of the filename.</p>
<pre class="r"><code>saveRDS(fit, &quot;my_brms_model.rds&quot;)

# To load the model object in a fresh R session:
fit &lt;- readRDS(&quot;my_brms_model.rds&quot;)</code></pre>
<p><br></p>
<p>Onto the results!</p>
<pre class="r"><code>fit</code></pre>
<pre><code>##  Family: MV(gaussian, gaussian) 
##   Links: mu = identity; sigma = identity
##          mu = identity; sigma = identity 
## Formula: f_reldis ~ time7c + f_wrkstrscw + f_wrkstrscb + (time7c + f_wrkstrscw | p | coupleid) 
##          m_reldis ~ time7c + m_wrkstrscw + +m_wrkstrscb + (time7c + m_wrkstrscw | p | coupleid) 
##    Data: ch8 (Number of observations: 2100) 
## Samples: 4 chains, each with iter = 8000; warmup = 4000; thin = 1;
##          total post-warmup samples = 16000
## 
## Correlation Structures:
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## ar_freldis[1]    -0.00      0.02    -0.05     0.05 1.00    13674    11705
## ar_mreldis[1]     0.02      0.02    -0.03     0.06 1.00    15773    11841
## 
## Group-Level Effects: 
## ~coupleid (Number of levels: 100) 
##                                              Estimate Est.Error l-95% CI
## sd(freldis_Intercept)                            0.98      0.08     0.85
## sd(freldis_time7c)                               0.07      0.05     0.00
## sd(freldis_f_wrkstrscw)                          0.12      0.04     0.04
## sd(mreldis_Intercept)                            1.04      0.08     0.90
## sd(mreldis_time7c)                               0.04      0.03     0.00
## sd(mreldis_m_wrkstrscw)                          0.17      0.03     0.11
## cor(freldis_Intercept,freldis_time7c)           -0.05      0.31    -0.64
## cor(freldis_Intercept,freldis_f_wrkstrscw)       0.39      0.19     0.00
## cor(freldis_time7c,freldis_f_wrkstrscw)         -0.18      0.35    -0.77
## cor(freldis_Intercept,mreldis_Intercept)         0.25      0.10     0.05
## cor(freldis_time7c,mreldis_Intercept)            0.13      0.30    -0.49
## cor(freldis_f_wrkstrscw,mreldis_Intercept)      -0.00      0.20    -0.40
## cor(freldis_Intercept,mreldis_time7c)           -0.04      0.33    -0.68
## cor(freldis_time7c,mreldis_time7c)              -0.07      0.38    -0.75
## cor(freldis_f_wrkstrscw,mreldis_time7c)          0.10      0.37    -0.63
## cor(mreldis_Intercept,mreldis_time7c)           -0.04      0.33    -0.66
## cor(freldis_Intercept,mreldis_m_wrkstrscw)      -0.03      0.15    -0.32
## cor(freldis_time7c,mreldis_m_wrkstrscw)          0.11      0.33    -0.60
## cor(freldis_f_wrkstrscw,mreldis_m_wrkstrscw)     0.30      0.25    -0.24
## cor(mreldis_Intercept,mreldis_m_wrkstrscw)       0.16      0.15    -0.13
## cor(mreldis_time7c,mreldis_m_wrkstrscw)          0.04      0.36    -0.66
##                                              u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(freldis_Intercept)                            1.14 1.00     2009     3961
## sd(freldis_time7c)                               0.17 1.00     1758     4890
## sd(freldis_f_wrkstrscw)                          0.19 1.00     3205     3371
## sd(mreldis_Intercept)                            1.21 1.00     4970     8237
## sd(mreldis_time7c)                               0.12 1.00     4200     6970
## sd(mreldis_m_wrkstrscw)                          0.23 1.00     6374     7027
## cor(freldis_Intercept,freldis_time7c)            0.58 1.00    17961     9147
## cor(freldis_Intercept,freldis_f_wrkstrscw)       0.74 1.00     8648     8469
## cor(freldis_time7c,freldis_f_wrkstrscw)          0.57 1.00     1988     4350
## cor(freldis_Intercept,mreldis_Intercept)         0.44 1.00     4298     7248
## cor(freldis_time7c,mreldis_Intercept)            0.69 1.02      333      545
## cor(freldis_f_wrkstrscw,mreldis_Intercept)       0.39 1.00      934     1985
## cor(freldis_Intercept,mreldis_time7c)            0.61 1.00    20720    11166
## cor(freldis_time7c,mreldis_time7c)               0.68 1.00     9350    11188
## cor(freldis_f_wrkstrscw,mreldis_time7c)          0.75 1.00    13586    12355
## cor(mreldis_Intercept,mreldis_time7c)            0.62 1.00    19811    11199
## cor(freldis_Intercept,mreldis_m_wrkstrscw)       0.28 1.00    12210    11845
## cor(freldis_time7c,mreldis_m_wrkstrscw)          0.70 1.00     1195     1903
## cor(freldis_f_wrkstrscw,mreldis_m_wrkstrscw)     0.74 1.00     2828     3619
## cor(mreldis_Intercept,mreldis_m_wrkstrscw)       0.44 1.00    14676    13864
## cor(mreldis_time7c,mreldis_m_wrkstrscw)          0.70 1.00     2327     6231
## 
## Population-Level Effects: 
##                     Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## freldis_Intercept       4.65      0.10     4.44     4.85 1.00     1309     2570
## mreldis_Intercept       5.09      0.11     4.88     5.30 1.00     4017     6597
## freldis_time7c         -0.02      0.03    -0.08     0.03 1.00    19847    12168
## freldis_f_wrkstrscw     0.16      0.03     0.11     0.21 1.00    12405    10671
## freldis_f_wrkstrscb     0.58      0.45    -0.34     1.43 1.00     1716     2906
## mreldis_time7c          0.01      0.02    -0.03     0.06 1.00    20006    12199
## mreldis_m_wrkstrscw     0.11      0.03     0.06     0.16 1.00    13574    12142
## mreldis_m_wrkstrscb    -0.14      0.45    -1.03     0.74 1.00     4315     7184
## 
## Family Specific Parameters: 
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma_freldis     1.00      0.02     0.97     1.03 1.00    12064    11320
## sigma_mreldis     0.87      0.01     0.85     0.90 1.00    15533    11944
## 
## Residual Correlations: 
##                         Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS
## rescor(freldis,mreldis)     0.07      0.02     0.03     0.12 1.00    19601
##                         Tail_ESS
## rescor(freldis,mreldis)    11617
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p><br></p>
<p>As seen from the model output, coefficients with the prefix <code>freldis_</code> correspond to effects on the female partner's outcome, and those with the prefix <code>mreldis_</code> correspond to effects on the male partner's outcomes. Normally, effects for female and male partners would be indicated through the use of dummy variables, but because of <em>brms</em> can estimate multivariate models, with two (or more), outcomes, we can get these separate effects automatically from our model set-up.</p>
<p>We also see that we have estimates of model parameters that are noteworthy for dyadic intensive longitudinal models, such as AR(1) errors, separate residual standard deviations, and a residual correlation between dyad members' outcomes. Of note, other programs, such as SAS, that also allow one to model these parameters typically generate one estimate of autocorrelation that is pooled across partners. So an advantage of <em>brms</em> is that we can get separate AR(1) estimates for each partner.</p>
<p>We also see that, thanks to the <code>|p|</code> part of our code in the <code>bf()</code> objects, we also get correlations among random effects across partners. For instance, <code>cor(freldis_f_wrkstrscw,mreldis_m_wrkstrscw)</code> gives us the correlation between the female partner's effect of work stressors on her relationship dissatisfaction and the male partner's effect of work stressors on his relationship dissatisfaction.</p>
<p><br></p>
</div>
</div>
<div id="fit-model-with-maximum-likelihood-nlme-to-compare" class="section level1">
<h1>Fit Model with Maximum Likelihood (<code>nlme</code>) to compare</h1>
<p>How do our results compare to what we get using traditional maximum likelihood estimation?</p>
<p>Here is the model using the stacked data approach, with dummy variables, in the <code>nlme</code> package (code drawn from this <a href="https://quantdev.ssri.psu.edu/tutorials/apa-ati-intensive-longitudinal-data-session-m-dyadic-multilevel-model" target="_blank">excellent tutorial</a> from the QuantDev group at Penn State). We can get separate error terms for each partner and a residual correlation, but not an AR(1) error structure.</p>
<p>Another difference is that the model did not converge with random slopes for time included, so they have been omitted here.</p>
<pre class="r"><code>library(nlme)
fit_nlme &lt;- lme(fixed=reldis ~ male + female + male:time7c + female:time7c +
               male:wrkstrscw + female:wrkstrscw +
               male:wrkstrscb + female:wrkstrscb + -1, 
             control=list(maxIter=1000), data=c,
             random=~male + female + male:wrkstrscw + female:wrkstrscw + -1| coupleid, 
             weights=varIdent(form = ~1 | gender), 
             corr=corCompSymm(form = ~1 | coupleid/time))
summary(fit_nlme)</code></pre>
<pre><code>## Linear mixed-effects model fit by REML
##  Data: c 
##        AIC      BIC    logLik
##   12096.16 12229.31 -6027.078
## 
## Random effects:
##  Formula: ~male + female + male:wrkstrscw + female:wrkstrscw + -1 | coupleid
##  Structure: General positive-definite, Log-Cholesky parametrization
##                  StdDev    Corr                
## male             1.0157904 male   female ml:wrk
## female           0.9600378  0.263              
## male:wrkstrscw   0.1678950  0.178 -0.019       
## female:wrkstrscw 0.1250147  0.007  0.485  0.502
## Residual         0.9981039                     
## 
## Correlation Structure: Compound symmetry
##  Formula: ~1 | coupleid/time 
##  Parameter estimate(s):
##        Rho 
## 0.07320727 
## Variance function:
##  Structure: Different standard deviations per stratum
##  Formula: ~1 | gender 
##  Parameter estimates:
##        1        0 
## 1.000000 0.873824 
## Fixed effects: reldis ~ male + female + male:time7c + female:time7c + male:wrkstrscw +      female:wrkstrscw + male:wrkstrscb + female:wrkstrscb + -1 
##                      Value Std.Error   DF  t-value p-value
## male              5.085720 0.1038242 4093 48.98397  0.0000
## female            4.647561 0.0989240 4093 46.98114  0.0000
## male:time7c       0.011615 0.0222292 4093  0.52251  0.6013
## female:time7c    -0.024921 0.0252926 4093 -0.98532  0.3245
## male:wrkstrscw    0.109398 0.0255077 4093  4.28885  0.0000
## female:wrkstrscw  0.159484 0.0251352 4093  6.34507  0.0000
## male:wrkstrscb   -0.141904 0.4388417 4093 -0.32336  0.7464
## female:wrkstrscb  0.623305 0.4276930 4093  1.45737  0.1451
##  Correlation: 
##                  male   female ml:tm7 fml:t7 ml:wrkstrscw fml:wrkstrscw
## female            0.253                                                
## male:time7c       0.015  0.001                                         
## female:time7c     0.001  0.018  0.071                                  
## male:wrkstrscw    0.115 -0.012 -0.004 -0.001                           
## female:wrkstrscw  0.003  0.234  0.001 -0.014  0.163                    
## male:wrkstrscb   -0.095 -0.003  0.002  0.001 -0.004        0.001       
## female:wrkstrscb  0.003  0.097  0.000 -0.002  0.001       -0.004       
##                  ml:wrkstrscb
## female                       
## male:time7c                  
## female:time7c                
## male:wrkstrscw               
## female:wrkstrscw             
## male:wrkstrscb               
## female:wrkstrscb -0.029      
## 
## Standardized Within-Group Residuals:
##           Min            Q1           Med            Q3           Max 
## -3.3784814878 -0.6500702762  0.0004838121  0.6501003315  3.3326568390 
## 
## Number of Observations: 4200
## Number of Groups: 100</code></pre>
<p><br></p>
<p>How do our results using <code>nlme</code> compare to those we got using <code>brms</code>? We generally see that the fixed effects are largely the same across the two analyses. The residual standard deviations and residual correlation are also very similar. As noted above, random effects for time could not be included in the <code>nlme</code> version due to convergence issues, and we don't have the AR(1) error structure. We could have specified the AR(1) error structure but would have had to sacrifice the residual correlation component in order to do so.</p>
<p>A trade-off is that Bayesian models can take a very long time to run (i.e., several hours, or for very complex models, even a whole day). But in my opinion, the added benefits of the Bayesian analysis make it worth the extra time and effort, and this is the route I would most likely go myself for analyzing dyadic intensive longitudindal data.</p>
<p></font></p>
<p><br></p>
<p><font size="2"> <em><a href="/Users/zeekatherine/Desktop/WorkSchool/kzee.github.io/DyadicMLM_Demo.Rmd" target="_blank">View .Rmd source code</a></em> </font> <font size="2"><br />
<em>updated June 14, 2020</em> </font></p>
<p><a href="#top">Back to top</a></p>
</div>

<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title></title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 64px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h2 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h3 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h4 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h5 {
  padding-top: 69px;
  margin-top: -69px;
}
.section h6 {
  padding-top: 69px;
  margin-top: -69px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Katherine S. Zee</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="research.html">Research</a>
</li>
<li>
  <a href="publications.html">Publications</a>
</li>
<li>
  <a href="teaching.html">Teaching</a>
</li>
<li>
  <a href="rcode.html">R Code</a>
</li>
<li>
  <a href="resources.html">Resources</a>
</li>
<li>
  <a href="files/KatherineZeeCV.pdf">CV</a>
</li>
<li>
  <a href="contact.html">Contact</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<p><font size="2"></p>
 
<hr />
<!--  <p> Copyright &copy; 2019 Katherine S. Zee. All rights reserved. </p>   -->
<p style="text-align: center;">
<span style="color: #808080;"><em><a href="mailto:ksz2104@columbia.edu">ksz2104@columbia.edu</a></em></span>
</p>
<p></font></p>
<!-- Add icon library -->
<p><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"></p>
<p><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous"></p>
<p><link rel="stylesheet" href="https://cdn.rawgit.com/jpswalsh/academicons/master/css/academicons.min.css"></p>
<!-- Add font awesome icons -->
<p style="text-align: center;">
<a href="https://twitter.com/KatherineZee?lang=en/" target="_blank" class="fab fa-twitter"></a> <a href="https://github.com/kzee/" target="_blank" class="fab fa-github"></a> <a href="https://osf.io/g579q" target="_blank" class="ai ai-osf ai-1x"></a> <a href="https://www.researchgate.net/profile/Katherine_Zee" target="_blank" class="fab fa-researchgate"></a>
</p>
<font size="2">
<p style="text-align: center;">
<span style="color: #808080;">The material above reflects the best of my knowledge on this topic. Please be sure to check your results and code carefully.</span>
</p>
<p></font></p>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
